# 一、这个 图表组件“必须具备”哪些功能

### 🔹 1. 基础绘图能力（核心，必做）

**这是组件存在的理由**

* 支持多种图
* 可配置：

---

### 🔹 2. 坐标系与网格（必做）

你现在这套已经有了，拆出来即可：

* X 轴（分类）
* Y 轴（连续数值）
* 主刻度 + 次刻度

---

### 🔹 3. Resize & 自适应（必做）

在 React 里这是**标配**

* 容器 resize 自动重绘
* 支持 `autoFit`
* ResizeObserver

---

### 🔹 5. 工具栏（强烈建议，但独立）

你现有的工具栏非常“业务友好”，值得保留，但**不能写死在图表里**：

* 全屏
* 放大 / 缩小
* 自适应
* 参数设置
* 导出 SVG / PNG

👉 **Toolbar 是一个独立组件**

---

## 二、推荐的 React 组件拆分（非常关键）

### ✅ 正确拆分方式（建议你照抄）

```txt
Chart (对外组件)
│
├── ChartContainer   // 尺寸 / resize / fullscreen
│
├── ChartToolbar     // 全屏 / zoom / download
│
└── ViolinSvg        // 只负责 SVG + D3
    ├── Axis
    ├── Grid
    └── ViolinMarks
以及其他多种图
```

### ❌ 不推荐

* Toolbar 和 D3 混在一起
* React 组件里到处 `d3.select('#xxx')`

---

## 三、推荐布局结构

### 🧱 整体布局（flex + position）

```jsx
<div className="violin-chart">
  <div className="chart-header">
    <ChartToolbar />
  </div>

  <div className="chart-body">
    <svg />
  </div>
</div>
```

### 📐 样式要点

* header 固定高度（40px）
* body 自适应剩余高度
* svg 宽高由 body 控制
* svg 内部再用 margin

---

## 四、我帮你设计一套**实战型 props 接口**

### 🔹 ViolinChart Props（对外）

```ts
type ViolinChartProps = {
  data: Array<{
    name: string        // PRE / POST
    values: number[]
  }>

  width?: number
  height?: number
  autoFit?: boolean

  yDomain?: [number, number]
  bandwidth?: number

  colors?: string[]

  showGrid?: boolean
  showToolbar?: boolean

  onZoomChange?: (domain) => void
}
```

---

### 🔹 内部 Svg Props（D3 专用）

```ts
type ViolinSvgProps = {
  data
  width
  height
  margin

  xScale
  yScale

  bandwidth
  colors
}
```

---

## 五、你这张图「未来可扩展」但现在别急着做的能力

我先帮你规划好，但**不建议第一版就做**：

* 中位数 / 均值线
* 数据点抖动（jitter）
* 对数轴
* 双 Y 轴
* 横向 violin
